---- Query A - Get all mqsvc.exe process instances with child processes----


SELECT EVENT_TIME                           AS EVENT_TIME,
       AGENT_ID                             AS EDR_AGENT_ID,
       AGENT_EXTERNAL_IP                    AS EDR_AGENT_EXTERNAL_IP,
       DEVICE_NAME                          AS DEVICE_NAME,
    --- PARENT_PROCESS INFO
       PARENT_PROCESS_NAME                  AS PARENT_PROCESS_NAME,
       PARENT_PROCESS_CREATION_TIME         AS PARENT_PROCESS_CREATION_TIME,
       PARENT_PROCESS_OS_PID                AS PARENT_PROCESS_OS_PID,
    --- INITIATING_PROCESS INFO
       INITIATING_PROCESS_NAME              AS INITIATING_PROCESS_NAME,
       INITIATING_PROCESS_CREATION_TIME     AS INITIATING_PROCESS_CRATION_TIME,
       INITIATING_PROCESS_USERNAME          AS INITIATING_PROCESS_USERNAME,
       INITIATING_PROCESS_PATH              AS INITIATING_PROCESS_PATH,
       INITIATING_PROCESS_HASH_SHA256       AS INITIATING_PROCESS_HASH,
       INITIATING_PROCESS_OS_PID            AS INITIATING_PROCESS_OS_PID,
    --- TARGET_PROCESS INFO
       TARGET_PROCESS_CREATION_TIME         AS TARGET_PROCESS_CREATION_TIME,
       TARGET_PROCESS_USERNAME              AS TARGET_PROCESS_USERNAME,
       TARGET_PROCESS_NAME                  AS TARGET_PROCESS_NAME,
       TARGET_PROCESS_PATH                  AS TARGET_PROCESS_PATH,
       TARGET_PROCESS_COMMANDLINE           AS TARGET_PROCESS_COMMANDLINE,
       TARGET_PROCESS_HASH_SHA256           AS TARGET_PROCESS_HASH,
       TARGET_PROCESS_OS_PID                AS TARGET_PROCESS_OS_PID
  FROM INVESTIGATION.EDR_PROCESS_CREATION_EVENTS
WHERE LOWER(INITIATING_PROCESS_NAME) = 'mqsvc.exe'
  AND TARGET_PROCESS_NAME IS NOT NULL
  AND EVENT_TIME > CURRENT_TIMESTAMP - INTERVAL '30 days'
