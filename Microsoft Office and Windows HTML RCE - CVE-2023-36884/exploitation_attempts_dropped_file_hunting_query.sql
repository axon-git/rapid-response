-- This query detects potential exploitation attempts by looking for .url, .xml and .asp files in the "Temporary Internet Files" directory, dropped by Office processes
-- References:
-- 1: https://blogs.blackberry.com/en/2023/07/romcom-targets-ukraine-nato-membership-talks-at-nato-summit
-- 2: https://twitter.com/wdormann/status/1679184475677130755?s=20
select *
from investigation.EDR_FILE_EVENTS
where lower(TARGET_FILE_NAME) like any ('%.url', '%.xml', '%.asp')
  and lower(TARGET_FILE_PATH) like '%temporary internet files%'
  and LOWER(INITIATING_PROCESS_NAME) in
      ('winproj.exe', 'winword.exe', 'msaccess.exe', 'visio.exe', 'powerpoint.exe', 'excel.exe', 'wordpad.exe',
       'mspub.exe', 'graph.exe')
  and event_time > current_timestamp - interval '45d'
