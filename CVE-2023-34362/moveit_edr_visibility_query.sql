-- This query detects Moveit Transfer servers based on EDR process creation logs

SELECT DISTINCT AGENT_ID,
                LAST_HOSTNAME hostname,
                TARGET_PROCESS_PATH,
                MIN(EVENT_TIME) first_seen,
                MAX(EVENT_TIME) last_seen
  FROM INVESTIGATION.EDR_PROCESS_CREATION_EVENTS JOIN INVESTIGATION.EDR_AGENT_INFO ON AGENT_ID = AID
 WHERE EVENT_TIME >= CURRENT_TIMESTAMP - INTERVAL '30 days'
     AND TARGET_PROCESS_PATH ILIKE '%\\MOVEitTransfer\\%'
GROUP BY 1,2,3
